<!--分析户型页面-->
<view class="analysis-container">
  <!-- 户型描述 -->
  <view class="section">
    <view class="section-title">户型描述</view>
    <view class="form-item">
      <view class="form-label">户型详情</view>
      <t-textarea
        placeholder="请详细描述您的户型布局，如：进门是玄关，左边是客厅，右边是餐厅，主卧朝南，次卧朝北，厨房在西边，卫生间在北边等..."
        value="{{formData.houseDescription}}"
        bind:change="onFormChange"
        data-field="houseDescription"
        maxlength="500"
        indicator
        autosize
      />
    </view>
    <view class="upload-tip">请尽可能详细地描述户型布局，有助于获得更准确的分析结果</view>
  </view>

  <!-- 基本信息 -->
  <view class="section">
    <view class="section-title">基本信息</view>
    
    <!-- 生辰八字 -->
    <view class="form-item">
      <view class="form-label">生辰八字</view>
      <t-input
        placeholder="请输入出生日期时间，如：1990-01-01 08:30 男"
        value="{{formData.birthInfo}}"
        bind:change="onFormChange"
        data-field="birthInfo"
      />
    </view>

    <!-- 房屋朝向 -->
    <view class="form-item">
      <view class="form-label">房屋朝向</view>
      <t-input
        placeholder="请输入房屋朝向，如：南北通透"
        value="{{formData.orientation}}"
        bind:change="onFormChange"
        data-field="orientation"
      />
    </view>

    <!-- 房屋面积 -->
    <view class="form-item">
      <view class="form-label">房屋面积</view>
      <t-input
        placeholder="请输入面积，如：98"
        value="{{formData.area}}"
        bind:change="onFormChange"
        data-field="area"
        type="number"
      />
    </view>

    <!-- 房间数 -->
    <view class="form-item">
      <view class="form-label">房间数</view>
      <t-input
        placeholder="请输入房间数，如：3室2厅"
        value="{{formData.rooms}}"
        bind:change="onFormChange"
        data-field="rooms"
      />
    </view>

    <!-- 楼层信息 -->
    <view class="form-item">
      <view class="form-label">楼层信息</view>
      <view class="floor-inputs">
        <t-input
          placeholder="当前楼层"
          value="{{formData.floor}}"
          bind:change="onFormChange"
          data-field="floor"
          type="number"
          style="flex: 1; margin-right: 16rpx;"
        />
        <text style="line-height: 80rpx;">/</text>
        <t-input
          placeholder="总楼层"
          value="{{formData.totalFloors}}"
          bind:change="onFormChange"
          data-field="totalFloors"
          type="number"
          style="flex: 1; margin-left: 16rpx;"
        />
      </view>
    </view>
  </view>

  <!-- 关注方面 -->
  <view class="section">
    <view class="section-title">关注方面</view>
    <view class="tag-container">
      <t-tag
        wx:for="{{focusOptions}}"
        wx:key="value"
        theme="{{item.selected ? 'primary' : 'default'}}"
        size="medium"
        bind:tap="onFocusTagTap"
        data-value="{{item.value}}"
        data-index="{{index}}"
      >
        {{item.label}}
      </t-tag>
    </view>
  </view>

  <!-- 分析结果 -->
  <view class="section" wx:if="{{analysisResult}}">
    <view class="section-title">
      分析结果
      <view class="status-indicator">
        <t-icon name="check-circle-filled" size="24rpx" color="#00a870" />
        <text class="status-text">分析完成</text>
      </view>
    </view>

    <!-- 总体评分 -->
    <view class="overall-score">
      <view class="score-title">综合评分</view>
      <view class="score-value">{{overallScore}}</view>
      <view class="score-unit">分</view>
    </view>

    <!-- 分析详情 -->
    <view class="analysis-results">
      <view 
        class="result-item" 
        wx:for="{{analysisResult.aspects}}" 
        wx:key="type"
        style="border-left-color: {{item.color}}"
      >
        <view class="result-header">
          <view class="result-title">{{item.title}}</view>
          <view class="result-score">{{item.score}}分</view>
        </view>
        <view class="result-content">
          <text class="content-text">{{item.content}}</text>
        </view>
        <view class="result-suggestions" wx:if="{{item.suggestions && item.suggestions.length > 0}}">
          <view class="suggestions-title">改善建议：</view>
          <view class="suggestion-item" wx:for="{{item.suggestions}}" wx:for-item="suggestion" wx:key="*this">
            • {{suggestion}}
          </view>
        </view>
      </view>
    </view>

    <!-- 总结 -->
    <view class="analysis-summary" wx:if="{{analysisResult.summary}}">
      <view class="summary-title">分析总结</view>
      <view class="summary-content">
        <text class="summary-text">{{analysisResult.summary}}</text>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-buttons">
    <t-button
      theme="primary"
      size="large"
      block
      bind:tap="startAnalysis"
      disabled="{{isAnalyzing}}"
      loading="{{isAnalyzing}}"
    >
      {{isAnalyzing ? '分析中...' : '开始分析'}}
    </t-button>
  </view>

  <!-- 分析中状态 -->
  <view class="analyzing-overlay" wx:if="{{isAnalyzing}}">
    <view class="analyzing-content">
      <t-loading size="60rpx" />
      <text class="analyzing-text">AI正在分析中，请稍候...</text>
    </view>
  </view>
</view>

<!-- Toast提示 -->
<t-toast id="t-toast" />
