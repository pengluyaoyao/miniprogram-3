# ⚠️ 紧急修复：14秒超时问题

## 问题原因

`cloudfunctions.json` 中设置了 120 秒，但云端实际只有 14 秒！

**原因**: 配置文件不会自动同步到云端，必须在云控制台手动修改。

## 🚨 立即修复（3分钟）

### 方法 1: 云开发控制台（推荐）⭐

1. **打开云开发控制台**
   ```
   https://console.cloud.tencent.com/tcb
   ```

2. **找到云函数**
   ```
   点击左侧菜单: 云函数
   ↓
   找到: aiAnalysis
   ↓
   点击函数名称进入详情
   ```

3. **修改配置**
   ```
   点击顶部: 函数配置
   ↓
   点击右上角: 编辑
   ↓
   修改以下配置:
   
   执行超时时间: 120 秒（或更长，如 180 秒）
   运行内存: 512 MB
   
   ↓
   点击底部: 保存
   ```

4. **等待生效**
   ```
   保存后等待 10-30 秒
   配置会自动生效，无需重新部署
   ```

### 方法 2: 使用命令行工具

如果安装了腾讯云 CLI：

```bash
# 更新云函数配置
tcb fn code update aiAnalysis --timeout 120

# 或者
tcb fn config update aiAnalysis --timeout 120 --memory 512
```

## ✅ 验证配置

### 1. 在云控制台确认

```
云函数 → aiAnalysis → 函数配置

应该显示:
✅ 执行超时时间: 120 秒（或 180 秒）
✅ 运行内存: 512 MB
```

### 2. 重新测试

在小程序中重新测试分析功能：

```
1. 刷新小程序
2. 进入分析页面
3. 输入户型描述
4. 点击"开始分析"
5. 等待 30-90 秒
6. 应该成功返回结果
```

## 📊 配置对照表

| 位置 | 超时时间 | 状态 |
|------|----------|------|
| cloudfunctions.json | 120 秒 | ✅ 正确（但不生效） |
| **云开发控制台** | **14 秒** | ⚠️ **需要修改** |
| 目标配置 | **120 秒** | 🎯 **手动设置** |

## 🎯 推荐配置

在云控制台设置：

```
执行超时时间: 180 秒（3分钟，更安全）
运行内存: 512 MB
环境变量:
  - DASHSCOPE_API_KEY: sk-xxxxxxxxxxxx
  - APP_ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

## 📝 详细步骤截图说明

### 步骤 1: 进入云开发控制台

浏览器打开: https://console.cloud.tencent.com/tcb

![控制台首页]

### 步骤 2: 选择环境

选择你的小程序环境（例如：cloud1-xxx）

### 步骤 3: 进入云函数

左侧菜单 → 云函数 → 看到 aiAnalysis

### 步骤 4: 点击函数名称

点击 `aiAnalysis` 进入函数详情

### 步骤 5: 修改配置

顶部菜单: 函数配置 → 右上角: 编辑

找到以下字段：

```
基础配置
  执行超时时间: [  14  ] 秒  ← 改为 180
  运行内存: [  256  ] MB  ← 改为 512

环境变量
  DASHSCOPE_API_KEY: sk-xxxxxxxxxxxx
  APP_ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
```

### 步骤 6: 保存

点击底部"保存"按钮，等待配置更新完成。

## ⚠️ 重要提醒

### 配置不会自动同步！

```
cloudfunctions.json (本地配置文件)
    ↓ ❌ 不会自动同步
云开发控制台 (云端实际配置)
    ↑ ✅ 必须手动修改
```

### 两种方式对比

| 方式 | 生效时间 | 是否自动 | 推荐 |
|------|---------|---------|------|
| 修改 cloudfunctions.json | 部署时 | 可能不生效 | ❌ |
| **云控制台手动修改** | **立即** | **手动** | **✅** |

## 🐛 如果还是超时

### 1. 确认配置已保存

在云控制台刷新页面，确认超时时间已更新为 180 秒

### 2. 清除缓存

```
微信开发者工具 → 清除缓存 → 全部清除
小程序 → 删除 → 重新打开
```

### 3. 查看云函数日志

```
云开发控制台 → 云函数 → aiAnalysis → 日志

查找:
⏱️ 百炼API耗时: XX.XX 秒

如果耗时 > 150 秒:
  → 说明 API 确实很慢
  → 需要优化或使用异步模式
```

### 4. 增加到更长时间

如果 180 秒还不够，可以设置为：

```
执行超时时间: 300 秒（5分钟）
```

腾讯云函数最大支持 900 秒（15分钟）

## 📞 还需要帮助？

### 检查清单

- [ ] 已在云控制台修改超时时间为 180 秒
- [ ] 已在云控制台修改内存为 512 MB
- [ ] 已配置环境变量 DASHSCOPE_API_KEY
- [ ] 已配置环境变量 APP_ID
- [ ] 刷新页面确认配置已保存
- [ ] 重新测试分析功能
- [ ] 查看云函数日志确认实际耗时

### 如果全部完成还是超时

告诉我：
1. 云控制台显示的超时时间是多少？
2. 云函数日志中显示的 API 耗时是多少？
3. 错误信息中显示的超时时间是多少？

---

**关键要点**: 
- ⚠️ 配置文件只是模板，不会自动同步
- ✅ 必须在云控制台手动修改
- 🚀 修改后立即生效，无需重新部署

**现在就去改吧！** → https://console.cloud.tencent.com/tcb

